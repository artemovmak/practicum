# Интеграция Istio с Kubernetes-системой

Данное решение реализует интеграцию сервисной сетки Istio с существующей Kubernetes-системой.

## Компоненты

1. **Istio Gateway (`gateway.yaml`)**: 
   - Принимает HTTP-трафик на порту 80
   - Точка входа для всех внешних запросов

2. **Virtual Service (`virtualservice.yaml`)**:
   - Маршрутизирует трафик к основному приложению
   - Специальная обработка конечной точки `/log` с искусственной задержкой
   - Возвращает ошибку 404 для всех неизвестных маршрутов

3. **Destination Rules**:
   - `destinationrule.yaml`: Конфигурация для основного приложения
   - `log-destinationrule.yaml`: Конфигурация для агента логирования
   - Оба используют:
     - Алгоритм балансировки нагрузки LEAST_CONN
     - Ограничения соединений (3 TCP-соединения, 5 ожидающих HTTP-запросов)
     - Режим TLS ISTIO_MUTUAL

4. **Скрипт развертывания (`deploy.sh`)**:
   - Устанавливает и настраивает сервисную сетку Istio
   - Включает автоматическую инъекцию sidecar-контейнеров
   - Применяет все ресурсы Kubernetes и Istio

## Реализованные функции

1. **Доступ внешнего трафика**:
   - Трафик поступает через Istio Gateway на порту 80

2. **Маршрутизация трафика**:
   - Основные маршруты направлены к custom-app-service
   - Неизвестные маршруты возвращают ошибку 404

3. **Управление соединениями**:
   - Балансировка нагрузки с алгоритмом LEAST_CONN
   - Ограничения соединений для предотвращения перегрузки

4. **Тестирование отказоустойчивости**:
   - 2-секундная задержка добавлена к конечной точке `/log`
   - 1-секундный таймаут для принудительных ошибок по таймауту
   - До 2 повторных попыток для неудавшихся запросов

5. **Защищенное взаимодействие**:
   - Взаимная TLS-аутентификация между сервисами с использованием встроенной безопасности Istio

## Как использовать

1. Убедитесь, что у вас установлены `kubectl` и `istioctl`.
2. Запустите скрипт развертывания:
   ```
   ./deploy.sh
   ```
3. Получите доступ к приложению через Istio ingress gateway:
   ```
   kubectl get svc istio-ingressgateway -n istio-system
   ```
4. Используйте внешний IP-адрес для доступа к приложению:
   ```
   http://<EXTERNAL-IP>/
   ```
5. Протестируйте искусственную задержку на конечной точке логирования:
   ```
   http://<EXTERNAL-IP>/log
   ``` 
